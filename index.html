<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title> NEST 333 xv - –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä –æ—Ç HABBA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: url('images/fon-video.gif') center/cover fixed;
            background-color: #1a1a2e; /* fallback —Ü–≤–µ—Ç */
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            transform: translateZ(0); /* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ */
            -webkit-font-smoothing: antialiased;
        }

        /* –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 480px;
            margin: 0 auto;
            background: rgba(16, 20, 60, 0.1); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ–Ω–∞ */
            overflow: hidden;
        }

        /* Canvas –¥–ª—è —Ñ–æ–Ω–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* –ò–≥—Ä–æ–∫ */
        #player {
            position: absolute;
            width: 100px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 60px –¥–æ 100px (1.67x) */
            height: 100px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 60px –¥–æ 100px (1.67x) */
            z-index: 10;
            transition: none; /* –£–±–∏—Ä–∞–µ–º –ø–ª–∞–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–æ—á–Ω–æ–π —Ñ–∏–∑–∏–∫–∏ */
        }

        .player-sprite {
            width: 100%;
            height: 121%;
            background-image: url('images/NEST_HERO.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            image-rendering: pixelated; /* –ß–µ—Ç–∫–∏–µ –ø–∏–∫—Å–µ–ª–∏ */
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            /* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ç—Ä—è—Å–∫–∏ - –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—á–Ω—ã–º */
            /* animation: idleWiggle 6s ease-in-out infinite; */
            transition: transform 0.1s ease-out; /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—è */
        @keyframes idleWiggle {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) rotate(0deg); 
            }
            50% { 
                transform: translateY(-1px) translateX(0px) rotate(0deg); 
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è - –ª–µ–≥–∫–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ */
        @keyframes walkBounce {
            0% { 
                transform: translateY(0px) scaleY(1); 
            }
            50% { 
                transform: translateY(-2px) scaleY(1.02); 
            }
            100% { 
                transform: translateY(0px) scaleY(1); 
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞ - —Å–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ */
        @keyframes jumpSquash {
            0% { 
                transform: scaleY(1) scaleX(1); 
            }
            30% { 
                transform: scaleY(0.9) scaleX(1.1); 
            }
            100% { 
                transform: scaleY(1.1) scaleX(0.95); 
            }
        }

        /* –ö–ª–∞—Å—Å—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
        .player-sprite.walking {
            animation: walkBounce 0.4s ease-in-out infinite;
        }

        .player-sprite.jumping {
            animation: jumpSquash 0.3s ease-out;
        }

        /* –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã - –∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç—ã (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ) */
        .platform {
            position: absolute;
            background: linear-gradient(135deg, 
                rgba(75, 0, 130, 0.95) 0%,        /* –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                rgba(138, 43, 226, 0.9) 50%,      /* –Ø—Ä–∫–∏–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
                rgba(25, 25, 112, 0.95) 100%);    /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
            border: 2px solid rgba(75, 0, 130, 0.7);
            border-radius: 8px;
            z-index: 5;
            box-shadow: 0 4px 8px rgba(75, 0, 130, 0.4);
        }

        /* –ó–≤–µ–∑–¥–æ—á–∫–∏ */
        .mushroom {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, 
                #ffd700 0%, 
                #ffed4e 25%, 
                #f1c40f 50%, 
                #d4af37 75%, 
                #b8860b 100%);
            border-radius: 50%;
            border: 2px solid #ffffff;
            z-index: 6;
            animation: starBob 2s ease-in-out infinite;
            cursor: pointer;
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.8),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }

        .mushroom::before {
            content: '‚≠ê';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
        }

        @keyframes starBob {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* –§—Ä–∞–∑—ã —Ç—Ä–µ–∫–∞ */
        .track-phrase {
            position: absolute;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
            text-align: center;
            z-index: 6;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            max-width: 200px;
            line-height: 1.2;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
            animation: phraseFloat 3s ease-in-out infinite;
        }

        .track-phrase.verse {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(35, 35, 65, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.4);
            box-shadow: 
                0 0 15px rgba(26, 26, 46, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .track-phrase.chorus {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(45, 35, 75, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 
                0 0 20px rgba(26, 26, 46, 0.9),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        @keyframes phraseFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-3px) scale(1.02); }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–±–æ—Ä–∞ */
        .collected {
            animation: collectEffect 0.6s ease-out forwards !important;
            pointer-events: none;
        }

        @keyframes collectEffect {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.3);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        }

        /* UI –ø–∞–Ω–µ–ª—å */
        .ui-panel {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
            z-index: 20;
        }

        .score-info {
            background: linear-gradient(135deg, 
                rgba(23, 32, 42, 0.9) 0%,
                rgba(44, 62, 80, 0.8) 100%);
            padding: 6px 10px;
            border-radius: 10px;
            color: #ecf0f1;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid rgba(52, 152, 219, 0.4);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            min-width: 50px;
            text-align: center;
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 15;
        }

        .control-group {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, 
                rgba(52, 152, 219, 0.8) 0%,
                rgba(41, 128, 185, 0.9) 100%);
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 
                0 4px 15px rgba(52, 152, 219, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .control-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, 
                rgba(41, 128, 185, 1) 0%,
                rgba(30, 115, 170, 1) 100%);
        }

        .jump-btn {
            background: linear-gradient(135deg, 
                rgba(231, 76, 60, 0.8) 0%,
                rgba(192, 57, 43, 0.9) 100%);
            box-shadow: 
                0 4px 15px rgba(231, 76, 60, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
        }

        .jump-btn:active {
            background: linear-gradient(135deg, 
                rgba(192, 57, 43, 1) 0%,
                rgba(169, 50, 38, 1) 100%);
        }

        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(10, 10, 20, 0.98) 0%, 
                rgba(15, 15, 35, 0.96) 50%, 
                rgba(20, 10, 40, 0.98) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            padding: 20px;
            font-weight: bold;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .menu-container {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 215, 0, 0.2);
            animation: slideUp 0.8s ease-out 0.3s both;
            font-weight: bold;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #startScreen h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 900;
            text-shadow: 
                0 0 30px rgba(255, 215, 0, 0.8),
                0 4px 8px rgba(0, 0, 0, 0.7);
            letter-spacing: 3px;
            background: linear-gradient(45deg, #ffd700, #ffed4e, #f1c40f, #ffd700);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .collab-title {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: #ffd700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                0 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: 800;
            opacity: 0;
            animation: fadeInUp 0.6s ease-out 0.6s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-instructions {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            font-size: 0.95em;
            font-weight: bold;
            line-height: 1.7;
            max-width: 350px;
            opacity: 0;
            animation: fadeInUp 0.6s ease-out 0.9s both;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .instruction-item:last-child {
            margin-bottom: 0;
        }

        .instruction-emoji {
            font-size: 1.2em;
            margin-right: 10px;
            width: 25px;
            text-align: center;
        }

        .instruction-text {
            flex: 1;
            text-align: left;
        }

        #startBtn {
            padding: 18px 40px;
            font-size: 1.3em;
            font-weight: 900;
            background: linear-gradient(135deg, 
                #1a1a2e 0%, 
                #16213e 50%, 
                #1a1a2e 100%);
            background-size: 200% 100%;
            color: #ffd700;
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6), 0 2px 4px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 215, 0, 0.2);
            opacity: 0;
            animation: bounceIn 0.8s ease-out 1.2s both;
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3) translateY(20px); }
            50% { transform: scale(1.1) translateY(-10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        #startBtn:hover {
            transform: translateY(-5px) scale(1.05);
            background-position: 100% 0;
            background: linear-gradient(135deg, 
                #0f0f23 0%, 
                #1a1a2e 50%, 
                #0f0f23 100%);
            box-shadow: 
                0 15px 40px rgba(255, 215, 0, 0.4),
                inset 0 1px 0 rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.7);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        #startBtn:active {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(231, 76, 60, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è */
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(16, 20, 60, 0.9); /* –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #gameOver h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #e74c3c;
        }

        .final-stats {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        #restartBtn {
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: 900;
            background: linear-gradient(135deg, 
                #1a1a2e 0%, 
                #16213e 50%, 
                #1a1a2e 100%);
            color: #ffd700;
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 25px;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6), 0 2px 4px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
        }

        #restartBtn:hover {
            transform: translateY(-3px) scale(1.05);
            background: linear-gradient(135deg, 
                #0f0f23 0%, 
                #1a1a2e 50%, 
                #0f0f23 100%);
            border-color: rgba(255, 215, 0, 0.7);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 2px 4px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 12px 30px rgba(255, 215, 0, 0.4),
                inset 0 1px 0 rgba(255, 215, 0, 0.3);
        }

        /* –§—Ä–∞–∑—ã —Ç—Ä–µ–∫–∞ */
        .track-phrase {
            position: absolute;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 900;
            color: #ffffff;
            text-align: center;
            z-index: 10;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                inset 1px 1px 0 rgba(255, 255, 255, 0.2);
            max-width: 200px;
            line-height: 1.3;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7);
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        .track-phrase:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 255, 255, 0.3);
        }

        .track-phrase.verse {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(35, 35, 65, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.4);
            box-shadow: 
                0 8px 25px rgba(26, 26, 46, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .track-phrase.intro {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(30, 40, 70, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 8px 25px rgba(26, 26, 46, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        .track-phrase.chorus {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(45, 35, 75, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 
                0 10px 30px rgba(26, 26, 46, 0.9),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            font-size: 18px;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        .track-phrase.outro {
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.95), 
                rgba(50, 40, 80, 0.9));
            border: 2px solid rgba(255, 215, 0, 0.7);
            box-shadow: 
                0 8px 25px rgba(26, 26, 46, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞ —Ñ—Ä–∞–∑—ã - –ø—Ä–æ—Å—Ç–æ–π –ø–ª—é—Å–∏–∫ */
        .collected {
            opacity: 0 !important;
            pointer-events: none;
        }
        
        /* –ü–ª—é—Å–∏–∫ –ø—Ä–∏ —Å–±–æ—Ä–µ (–∑–µ–ª–µ–Ω—ã–π –¥–ª—è —Ñ—Ä–∞–∑, –∑–æ–ª–æ—Ç–æ–π –¥–ª—è –∑–≤–µ–∑–¥) */
        .plus-effect {
            position: absolute;
            color: #00ff00;
            font-size: 24px;
            font-weight: bold;
            z-index: 100;
            animation: plusFade 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes plusFade {
            0% {
                opacity: 1;
                transform: translateY(0px);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 480px) {
            .menu-container {
                padding: 25px 20px;
                margin: 10px;
            }
            
            #startScreen h1 {
                font-size: 2.2em;
                font-weight: 900;
                letter-spacing: 2px;
            }
            
            .game-instructions {
                padding: 15px;
                font-size: 0.9em;
            }
            
            .instruction-item {
                margin-bottom: 6px;
            }
            
            .instruction-emoji {
                font-size: 1.1em;
                width: 22px;
            }
            
            #startBtn {
                padding: 16px 35px;
                font-size: 1.2em;
                font-weight: 900;
            }
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è hover —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .menu-container:hover {
            box-shadow: 
                0 25px 45px rgba(0, 0, 0, 0.7),
                inset 0 1px 0 rgba(255, 215, 0, 0.4);
            border-color: rgba(255, 215, 0, 0.6);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="480" height="800"></canvas>
        
        <!-- –ò–≥—Ä–æ–∫ -->
        <div id="player">
            <div class="player-sprite"></div>
        </div>
        
        <!-- UI –ø–∞–Ω–µ–ª—å -->
        <div class="ui-panel">
            <div class="score-info">
                <div style="color: #ecf0f1;">‚≠ê –ó–≤–µ–∑–¥—ã: <span id="mushroomCount">0</span></div>
                <div style="color: #f39c12;">üìù –§—Ä–∞–∑—ã: <span id="phraseCount">0</span></div>
            </div>
            <div class="score-info">
                <div style="color: #e74c3c;">üéØ –û—á–∫–∏: <span id="scoreCount">0</span></div>
                <div style="color: #9b59b6;">üìè –í—ã—Å–æ—Ç–∞: <span id="heightCount">0</span>–º</div>
            </div>
            <div class="score-info">
                <div style="color: #3498db;">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="livesCount">3</span></div>
            </div>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="mobile-controls">
            <div class="control-group">
                <div class="control-btn" id="leftBtn">‚Üê</div>
                <div class="control-btn" id="rightBtn">‚Üí</div>
            </div>
            <div class="control-btn jump-btn" id="jumpBtn">‚Üë</div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="startScreen">
        <div class="menu-container">
            <h1>NEST 333 xv</h1>
            <div class="collab-title">üéÆ –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä –∫–æ–ª–ª–∞–± üéµ</div>
            
            <div class="game-instructions">
                <div class="instruction-item">
                    <div class="instruction-emoji">üèîÔ∏è</div>
                    <div class="instruction-text">–ü—Ä—ã–≥–∞–π –≤–≤–µ—Ä—Ö - –Ω–µ —É–ø–∞–¥–∏</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">üéµ</div>
                    <div class="instruction-text">–°–ª—É—à–∞–π —Ç—Ä–µ–∫ "33.3 FM"</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">üéØ</div>
                    <div class="instruction-text">–¢–∞–ø = –ø—Ä—ã–∂–æ–∫, –≤—Ç–æ—Ä–æ–π —Ç–∞–ø = –¥–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">‚≠ê</div>
                    <div class="instruction-text">–°–æ–±–∏—Ä–∞–π –∑–≤–µ–∑–¥—ã –¥–ª—è –æ—á–∫–æ–≤</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">üìù</div>
                    <div class="instruction-text">–°–æ–±–∏—Ä–∞–π —Ñ—Ä–∞–∑—ã –∏–∑ —Ç—Ä–µ–∫–∞ –ø—Ä—ã–∂–∫–∞–º–∏</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">üìè</div>
                    <div class="instruction-text">–ü–æ–¥–Ω–∏–º–∞–π—Å—è –∫–∞–∫ –º–æ–∂–Ω–æ –≤—ã—à–µ –ø–æ–∫–∞ —Ç—Ä–µ–∫ –∏–≥—Ä–∞–µ—Ç</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-emoji">üë§</div>
                    <div class="instruction-text">created by HABBA</div>
                </div>
            </div>
            
            <button id="startBtn">üöÄ –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è -->
    <div id="gameOver">
        <h2>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
        <div class="final-stats">
                                <div>–°–æ–±—Ä–∞–Ω–æ –∑–≤–µ–∑–¥: <span id="finalMushrooms">0</span></div>
            <div>–ù–∞–π–¥–µ–Ω–æ —Ñ—Ä–∞–∑: <span id="finalPhrases">0</span></div>
            <div>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞: <span id="finalHeight">0</span>–º</div>
            <div>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="finalScore">0</span></div>
        </div>
        <button id="restartBtn">üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
    </div>

    <!-- –ê—É–¥–∏–æ —Ç—Ä–µ–∫ -->
    <audio id="backgroundMusic" preload="auto">
        <source src="kazhetsya/m4a/33.3 FM (prod nest 333 xv 2deep).mp3" type="audio/mpeg">
        <p>–ú—É–∑—ã–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
    </audio>

    <script>
        // –§—Ä–∞–∑—ã —Ç—Ä–µ–∫–∞ "33.3 FM" –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç)
        const trackPhrases = [
            { text: "üéµ 33.3 FM", timing: 1, type: "intro", order: 1 },
            { text: "33.3 FM", timing: 3, type: "verse", order: 2 },
            { text: "33.3 FM", timing: 5, type: "verse", order: 3 },
            { text: "33.3 FM", timing: 7, type: "verse", order: 4 },
            { text: "33.3 FM", timing: 9, type: "verse", order: 5 },
            { text: "33.3 FM", timing: 11, type: "verse", order: 6 },
            { text: "33.3 FM", timing: 13, type: "verse", order: 7 },
            { text: "33.3 FM", timing: 15, type: "verse", order: 8 },
            { text: "33.3 FM", timing: 17, type: "verse", order: 9 },
            { text: "33.3 FM", timing: 19, type: "verse", order: 10 },
            { text: "33.3 FM", timing: 21, type: "verse", order: 11 },
            { text: "33.3 FM", timing: 23, type: "verse", order: 12 },
            { text: "33.3 FM", timing: 25, type: "verse", order: 13 },
            { text: "33.3 FM", timing: 27, type: "verse", order: 14 },
            { text: "üéµ 33.3 FM", timing: 29, type: "outro", order: 15 },
            { text: "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å", timing: 30, type: "chorus", order: 16 },
            { text: "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å", timing: 31, type: "chorus", order: 17 },
            { text: "—è –¥–µ–ª–∞—é —ç—Ç–æ –¥–µ—Ä—å–º–æ", timing: 32, type: "verse", order: 18 },
            { text: "—É –º–µ–Ω—è —Å–≤–µ–≥–∞ –±–æ–ª—å—à–µ —á–µ–º —É —Ç–µ–±—è", timing: 39, type: "verse", order: 19 },
            { text: "–ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–∏", timing: 45, type: "outro", order: 20 },
            { text: "–º–Ω–µ –ø—Ä—è–º–æ –≤ –≥–ª–∞–∑–∞", timing: 49, type: "verse", order: 21 },
            { text: "—è –¥–∞–≤–Ω–æ –Ω–µ —Ç–∞–∫–æ–π", timing: 53, type: "verse", order: 22 },
            { text: "–∫–∞–∫–∏–º —Ç—ã –¥—É–º–∞–ª", timing: 55, type: "verse", order: 23 },
            { text: "—á—Ç–æ —è —è–≤–ª—è—é—Å—å", timing: 57, type: "verse", order: 24 },
            { text: "–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–æ–≤—ã–π —Å–≤—ç–≥", timing: 64, type: "chorus", order: 25 },
            { text: "–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–æ–≤—ã–π —Å–≤—ç–≥", timing: 69, type: "chorus", order: 26 },
            { text: "–ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –º–µ–Ω—è", timing: 70, type: "verse", order: 27 },
            { text: "–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–æ–≤—ã–π —Å–≤—ç–≥", timing: 72, type: "chorus", order: 28 },
            { text: "–ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –º–µ–Ω—è", timing: 74, type: "verse", order: 29 },
            { text: "–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–¥–∞–º—Å—è", timing: 76, type: "outro", order: 30 },
            { text: "–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–¥–∞–º—Å—è —è", timing: 78, type: "outro", order: 31 }
        ];

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let game = {
            // –ò–≥—Ä–æ–∫
            player: {
                x: 50,
                y: 620, // –ë—É–¥–µ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ startGame
                width: 100, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 100px
                height: 100, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 100px
                velX: 0,
                velY: 0,
                speed: 5,
                jumpPower: 18, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –ª—É—á—à–∏—Ö –ø—Ä—ã–∂–∫–æ–≤
                onGround: false,
                facing: 1 // 1 = right, -1 = left
            },
            
            // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            score: 0,
            stars: 0,
            phrases: 0,
            lives: 3,
            isRunning: false,
            gravity: 0.6, // —É–º–µ–Ω—å—à–µ–Ω–∞ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã—Ö –ø—Ä—ã–∂–∫–æ–≤
            coyoteTime: 0, // –≤—Ä–µ–º—è –¥–ª—è –ø—Ä—ã–∂–∫–∞ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            
            // –î–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫
            lastJumpTime: 0,
            jumpBoostWindow: 800, // 800–º—Å –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –ø—Ä—ã–∂–∫–∞ –≤ –≤–æ–∑–¥—É—Ö–µ
            canBoostJump: false, // –º–æ–∂–Ω–æ –ª–∏ —É—Å–∏–ª–∏—Ç—å –ø—Ä—ã–∂–æ–∫
            jumpPower: 12, // —Å–∏–ª–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä—ã–∂–∫–∞ (–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–ª—è –æ–±–æ–∏—Ö)
            
            // Doodle Jump –º–µ—Ö–∞–Ω–∏–∫–∞
            camera: {
                y: 0, // —Å–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
                targetY: 0 // —Ü–µ–ª–µ–≤–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
            },
            height: 0, // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∏–≥—Ä–æ–∫–∞
            platformSpacing: 120, // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞
            lastPlatformY: 0, // Y –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            
            // –û–±—ä–µ–∫—Ç—ã –∏–≥—Ä—ã
            platforms: [],
            starItems: [],
            phraseItems: [],
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            keys: {},
            canvas: null,
            ctx: null,

            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –º—É–∑—ã–∫–æ–π
            gameTime: 0,
            currentPhraseIndex: 0,
            expectedOrder: 1,
            activePhrases: [] // —Ñ—Ä–∞–∑—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            game.canvas = canvas;
            game.ctx = ctx;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
            const container = document.getElementById('gameContainer');
            game.canvas.width = container.offsetWidth;
            game.canvas.height = container.offsetHeight;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º—É–∑—ã–∫–∏
            const music = document.getElementById('backgroundMusic');
            music.addEventListener('ended', endGame);
            music.addEventListener('loadeddata', () => {
                // –ú—É–∑—ã–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
                document.getElementById('startBtn').disabled = false;
            });

            setupControls();
            createLevel();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –¥–ª—è Doodle Jump —Å—Ç–∏–ª—è
        function createLevel() {
            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            game.platforms = [];
            game.starItems = [];
            game.phraseItems = [];
            
            // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–Ω–∏–∑—É (—à–∏—Ä–æ–∫–∞—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
            const startY = game.canvas.height - 80;
            game.platforms.push({
                x: 0,
                y: startY,
                width: game.canvas.width,
                height: 20,
                id: 'platform-start'
            });
            
            game.lastPlatformY = startY;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤–≤–µ—Ä—Ö
            generatePlatformsUp(15); // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º 15 –ø–ª–∞—Ç—Ñ–æ—Ä–º –≤–≤–µ—Ä—Ö
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            updateVisualElements();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º –≤–≤–µ—Ä—Ö
        function generatePlatformsUp(count) {
            for (let i = 0; i < count; i++) {
                // –ü–µ—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 40% –±–ª–∏–∑–∫–æ (–æ–¥–∏–Ω –ø—Ä—ã–∂–æ–∫), 60% –¥–∞–ª–µ–∫–æ (–¥–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫) 
                const spacing = Math.random() < 0.4 ? 
                    (90 + Math.random() * 20) :   // 90-110px - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞
                    (130 + Math.random() * 20);   // 130-150px - –Ω—É–∂–µ–Ω –¥–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫
                const y = game.lastPlatformY - spacing;
                const width = 100 + Math.random() * 60; // —à–∏—Ä–∏–Ω–∞ –æ—Ç 100 –¥–æ 160 (—É–≤–µ–ª–∏—á–µ–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)
                const x = Math.random() * (game.canvas.width - width);
                
                const platform = {
                    x: x,
                    y: y,
                    width: width,
                    height: 20,
                    id: 'platform-' + Date.now() + '-' + i
                };
                
                game.platforms.push(platform);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (30% —à–∞–Ω—Å)
                if (Math.random() < 0.3) {
                    game.starItems.push({
                        x: x + width/2 - 15,
                        y: y - 40,
                        collected: false,
                        element: null,
                        id: 'star-' + Date.now() + '-' + i,
                        platformId: platform.id // –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞ –∫–∞–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
                    });
                }
                
                // –°–ª—É—á–∞–π–Ω—ã–µ —Ñ—Ä–∞–∑—ã —É–±—Ä–∞–Ω—ã - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å —Ç—Ä–µ–∫–æ–º!
                
                game.lastPlatformY = y;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function updateVisualElements() {
            const container = document.getElementById('gameContainer');
            const screenBottom = -game.camera.y + game.canvas.height + 200; // 200px –∑–∞–ø–∞—Å —Å–Ω–∏–∑—É
            
            // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –¥–∞–ª–µ–∫–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
            container.querySelectorAll('.platform, .mushroom, .track-phrase').forEach(el => {
                const elementY = parseInt(el.style.top);
                if (elementY > screenBottom) {
                    if (el.parentNode) el.parentNode.removeChild(el);
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç)
            game.platforms.forEach(platform => {
                let platformEl = document.getElementById(platform.id);
                if (!platformEl) {
                    platformEl = document.createElement('div');
                    platformEl.className = 'platform';
                    platformEl.style.left = platform.x + 'px';
                    platformEl.style.width = platform.width + 'px';
                    platformEl.style.height = platform.height + 'px';
                    platformEl.id = platform.id;
                    container.appendChild(platformEl);
                }
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –∫–∞–º–µ—Ä—ã
                platformEl.style.top = (platform.y + game.camera.y) + 'px';
            });
            
            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç)
            game.starItems.forEach(star => {
                if (!star.collected) {
                    if (!star.element || !star.element.parentNode) {
                        const starEl = document.createElement('div');
                        starEl.className = 'mushroom';
                        starEl.style.left = star.x + 'px';
                        starEl.id = star.id;
                        star.element = starEl;
                        container.appendChild(starEl);
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –∫–∞–º–µ—Ä—ã
                    star.element.style.top = (star.y + game.camera.y) + 'px';
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º —Ñ—Ä–∞–∑—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç)
            game.phraseItems.forEach(phrase => {
                if (!phrase.collected) {
                    if (!phrase.element || !phrase.element.parentNode) {
                        const phraseEl = document.createElement('div');
                        phraseEl.className = `track-phrase ${phrase.type}`;
                        phraseEl.textContent = phrase.text;
                        phraseEl.style.left = phrase.x + 'px';
                        phraseEl.id = phrase.id;
                        phrase.element = phraseEl;
                        container.appendChild(phraseEl);
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –∫–∞–º–µ—Ä—ã
                    phrase.element.style.top = (phrase.y + game.camera.y) + 'px';
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (Doodle Jump —Å—Ç–∏–ª—å)
        function updateCamera() {
            const playerWorldY = game.player.y; // –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –≤ –º–∏—Ä–µ
            const playerScreenY = playerWorldY + game.camera.y; // –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            const screenHeight = game.canvas.height;
            const screenCenterY = screenHeight / 2;
            const upperThreshold = screenHeight * 0.4; // 40% –æ—Ç –≤–µ—Ä—Ö–∞
            const lowerThreshold = screenHeight * 0.8; // 80% –æ—Ç –≤–µ—Ä—Ö–∞ (–±–ª–∏–∑–∫–æ –∫ –Ω–∏–∑—É)
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–¥–Ω—è–ª—Å—è –≤—ã—à–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ø–æ—Ä–æ–≥–∞, –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –≤–≤–µ—Ä—Ö
            if (playerScreenY < upperThreshold) {
                game.camera.targetY = upperThreshold - playerWorldY;
            }
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–ø–∞–ª –Ω–∏–∂–µ –Ω–∏–∂–Ω–µ–≥–æ –ø–æ—Ä–æ–≥–∞, –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –≤–Ω–∏–∑
            else if (playerScreenY > lowerThreshold) {
                game.camera.targetY = lowerThreshold - playerWorldY;
            }
            
            // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (–±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏)
            const isPlayerFalling = game.player.velY > 0;
            const cameraSpeed = isPlayerFalling ? 0.15 : 0.1; // –ë—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
            game.camera.y += (game.camera.targetY - game.camera.y) * cameraSpeed;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É
            const currentHeight = Math.max(0, -(playerWorldY - (game.canvas.height - 100)));
            if (currentHeight > game.height) {
                const heightDiff = currentHeight - game.height;
                game.height = currentHeight;
                game.score += Math.floor(heightDiff / 10); // –±–æ–Ω—É—Å –∑–∞ –≤—ã—Å–æ—Ç—É
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (game.lastPlatformY + game.camera.y > -200) { // –µ—Å–ª–∏ –≤–µ—Ä—Ö–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –±–ª–∏–∑–∫–æ –∫ —ç–∫—Ä–∞–Ω—É
                generatePlatformsUp(5);
                // updateVisualElements() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ updateGame() –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
            }
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –¥–∞–ª–µ–∫–æ –≤–Ω–∏–∑ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
            const cleanupThreshold = game.canvas.height + 200;
            
            game.platforms = game.platforms.filter(platform => 
                platform.y + game.camera.y < cleanupThreshold
            );
            
            game.starItems = game.starItems.filter(star => 
                star.y + game.camera.y < cleanupThreshold
            );
            
            game.phraseItems = game.phraseItems.filter(phrase => 
                phrase.y + game.camera.y < cleanupThreshold
            );
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function setupControls() {
            // –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ - Touch —Å–æ–±—ã—Ç–∏—è
            document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                game.keys.left = true;
            });
            
            document.getElementById('leftBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                game.keys.left = false;
            });

            document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                game.keys.right = true;
            });
            
            document.getElementById('rightBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                game.keys.right = false;
            });

            document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleJump();
            });

            // Click —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
            document.getElementById('leftBtn').addEventListener('mousedown', (e) => {
                e.preventDefault();
                game.keys.left = true;
            });
            
            document.getElementById('leftBtn').addEventListener('mouseup', (e) => {
                e.preventDefault();
                game.keys.left = false;
            });

            document.getElementById('rightBtn').addEventListener('mousedown', (e) => {
                e.preventDefault();
                game.keys.right = true;
            });
            
            document.getElementById('rightBtn').addEventListener('mouseup', (e) => {
                e.preventDefault();
                game.keys.right = false;
            });

            document.getElementById('jumpBtn').addEventListener('click', (e) => {
                e.preventDefault();
                handleJump();
            });

            // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'a') game.keys.left = true;
                if (e.key === 'ArrowRight' || e.key === 'd') game.keys.right = true;
                if (e.key === 'ArrowUp' || e.key === ' ') {
                    handleJump();
                }
            });

            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'a') game.keys.left = false;
                if (e.key === 'ArrowRight' || e.key === 'd') game.keys.right = false;
            });
        }

        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        function startGame() {
            game.isRunning = true;
            document.getElementById('startScreen').style.display = 'none';
            
            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ - —Å—Ç–∞–≤–∏–º –ù–ê —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
            game.player.x = 50;
            const startPlatformY = game.canvas.height - 80; // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç createLevel
            game.player.y = startPlatformY - game.player.height; // –¢–æ—á–Ω–æ –ù–ê –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

            // –ó–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            const music = document.getElementById('backgroundMusic');
            game.gameTime = 0;
            game.currentPhraseIndex = 0;
            game.expectedOrder = 1;
            game.activePhrases = [];
            
            music.currentTime = 0;
            music.play().catch(e => console.log('–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'));
            game.player.velX = 0;
            game.player.velY = 0;
            game.player.onGround = true; // –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞ –∑–µ–º–ª–µ
            
            // –°–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã, –≤—ã—Å–æ—Ç—ã –∏ coyote time
            game.camera.y = 0;
            game.camera.targetY = 0;
            game.height = 0;
            game.coyoteTime = 5; // –ù–∞—á–∏–Ω–∞–µ–º —Å coyote time
            game.lastJumpTime = 0; // –°–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä—ã–∂–∫–∞
            game.canBoostJump = false; // –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å–∏–ª–µ–Ω–∏—è
            
            updatePlayerPosition();
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            game.gameLoop = setInterval(() => {
                updateGame();
            }, 16); // ~60 FPS
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function updateGame() {
            if (!game.isRunning) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è —Ç—Ä–µ–∫–∞
            const music = document.getElementById('backgroundMusic');
            game.gameTime = music.currentTime;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            checkForNewPhrases();
            
            // –ó–∞–≤–µ—Ä—à–∞–µ–º –∏–≥—Ä—É –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–µ–∫–∞ (80 —Å–µ–∫ - –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ñ—Ä–∞–∑—ã)
            if (game.gameTime >= 80) {
                endGame();
                return;
            }
            
            updatePlayer();
            updateCamera(); // –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–º–µ—Ä—ã
            checkCollisions();
            updateVisualElements(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            updateUI();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ñ—Ä–∞–∑ –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å —Ç—Ä–µ–∫–æ–º
        function checkForNewPhrases() {
            while (game.currentPhraseIndex < trackPhrases.length && 
                   trackPhrases[game.currentPhraseIndex].timing <= game.gameTime) {
                addPhraseOnPlatform(trackPhrases[game.currentPhraseIndex]);
                game.currentPhraseIndex++;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑—ã –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –í–´–®–ï –∏–≥—Ä–æ–∫–∞
        function addPhraseOnPlatform(phraseData) {
            // –í—ã–±–∏—Ä–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¢–û–õ–¨–ö–û –í–´–®–ï –∏–≥—Ä–æ–∫–∞ –ë–ï–ó —Ñ—Ä–∞–∑
            const platformsAbovePlayer = game.platforms.filter(platform => {
                const platformWorldY = platform.y; // –ø–æ–∑–∏—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ –º–∏—Ä–µ
                const playerWorldY = game.player.y; // –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –≤ –º–∏—Ä–µ
                const isAbovePlayer = platformWorldY < playerWorldY - 50; // –Ω–∞ 50px –≤—ã—à–µ –∏–≥—Ä–æ–∫–∞
                const hasPhrase = platform.hasPhrase; // –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ñ—Ä–∞–∑–∞
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤ —Ä–∞–∑—É–º–Ω–æ–π –∑–æ–Ω–µ (–Ω–µ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ)
                const isReachable = platformWorldY > playerWorldY - 800; // –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 800px –≤—ã—à–µ
                
                return isAbovePlayer && !hasPhrase && isReachable;
            });

            if (platformsAbovePlayer.length === 0) {
                return; // –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
            }

            const randomPlatform = platformsAbovePlayer[Math.floor(Math.random() * platformsAbovePlayer.length)];
            
            // –ü–û–ú–ï–ß–ê–ï–ú –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∫–∞–∫ –∑–∞–Ω—è—Ç—É—é —Ñ—Ä–∞–∑–æ–π
            randomPlatform.hasPhrase = true;
            
            // –£–î–ê–õ–Ø–ï–ú –∑–≤–µ–∑–¥—ã —Å —ç—Ç–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –µ—Å–ª–∏ –µ—Å—Ç—å
            game.starItems = game.starItems.filter(star => {
                if (star.platformId === randomPlatform.id) {
                    // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∑–≤–µ–∑–¥—ã –∏–∑ DOM
                    if (star.element && star.element.parentNode) {
                        star.element.parentNode.removeChild(star.element);
                    }
                    // –£–±–∏—Ä–∞–µ–º –∑–≤–µ–∑–¥—É —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å —Ñ—Ä–∞–∑–æ–π
                    return false; // —É–±–∏—Ä–∞–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                }
                return true; // –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤–µ
            });
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ñ—Ä–∞–∑—ã
            const phraseEl = document.createElement('div');
            phraseEl.className = `track-phrase ${phraseData.type}`;
            phraseEl.textContent = phraseData.text;
            phraseEl.dataset.order = phraseData.order;
            
            // –†–∞–∑–º–µ—â–∞–µ–º –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
            phraseEl.style.position = 'absolute';
            phraseEl.style.left = (randomPlatform.x + randomPlatform.width/2 - 50) + 'px';
            phraseEl.style.top = (randomPlatform.y - 40 + game.camera.y) + 'px';
            phraseEl.style.zIndex = '10';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ—Ä–∞–∑
            const phraseItem = {
                x: randomPlatform.x + randomPlatform.width/2 - 50,
                y: randomPlatform.y - 40,
                text: phraseData.text,
                type: phraseData.type,
                order: phraseData.order,
                collected: false,
                element: phraseEl,
                id: 'phrase-' + Date.now(),
                platformId: randomPlatform.id // —Å–≤—è–∑—ã–≤–∞–µ–º —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
            };
            
            game.phraseItems.push(phraseItem);
            document.getElementById('gameContainer').appendChild(phraseEl);
            
            // –§—Ä–∞–∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤—ã—à–µ –∏–≥—Ä–æ–∫–∞
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function updatePlayer() {
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            if (game.keys.left) {
                game.player.velX = -game.player.speed;
                game.player.facing = -1;
            } else if (game.keys.right) {
                game.player.velX = game.player.speed;
                game.player.facing = 1;  
            } else {
                game.player.velX *= 0.8; // –¢–æ—Ä–º–æ–∂–µ–Ω–∏–µ
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
            game.player.x += game.player.velX;
            game.player.y += game.player.velY;

            // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
            if (!game.player.onGround) {
                game.player.velY += game.gravity;
            }
            
            // –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å–∏–ª–µ–Ω–∏—è –ø—Ä—ã–∂–∫–∞
            if (game.canBoostJump) {
                const timeSinceJump = Date.now() - game.lastJumpTime;
                const isRising = game.player.velY < -1; // –∏–≥—Ä–æ–∫ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –≤—Ä–µ–º—è –ò –∏–≥—Ä–æ–∫ –Ω–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è
                if (timeSinceJump > game.jumpBoostWindow && !isRising) {
                    game.canBoostJump = false;
                    // Jump boost window expired
                }
            }

            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
            if (game.player.x < 0) game.player.x = 0;
            if (game.player.x > game.canvas.width - game.player.width) {
                game.player.x = game.canvas.width - game.player.width;
            }

            // –ü–∞–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞ (—Å —É—á–µ—Ç–æ–º –∫–∞–º–µ—Ä—ã)
            if (game.player.y + game.camera.y > game.canvas.height + 100) {
                game.lives--;
                if (game.lives <= 0) {
                    endGame();
                } else {
                    // –†–µ—Å–ø–∞–≤–Ω –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
                    game.player.x = 50;
                    game.player.y = game.canvas.height - 100 - game.player.height;
                    game.player.velX = 0;
                    game.player.velY = 0;
                    game.player.onGround = true;
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–∞–º–µ—Ä—É
                    game.camera.y = 0;
                    game.camera.targetY = 0;
                    updateUI();
                }
            }

            updatePlayerPosition();
            updatePlayerSprite(); // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
        function checkCollisions() {
            const wasOnGround = game.player.onGround;
            game.player.onGround = false;

            // –ö–æ–ª–ª–∏–∑–∏–∏ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ 
            game.platforms.forEach(platform => {
                const playerLeft = game.player.x;
                const playerRight = game.player.x + game.player.width;
                const playerBottom = game.player.y + game.player.height;
                
                const platformLeft = platform.x;
                const platformRight = platform.x + platform.width;
                const platformTop = platform.y;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ X —Å –Ω–µ–±–æ–ª—å—à–∏–º –±—É—Ñ–µ—Ä–æ–º
                const overlapX = playerRight > platformLeft + 3 && playerLeft < platformRight - 3;
                
                // –¢–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏—è - –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–∞–¥–∞–µ—Ç –∏ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
                if (overlapX && game.player.velY >= 0) {
                    // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –Ω–∏–∑–∞ –∏–≥—Ä–æ–∫–∞ –¥–æ –≤–µ—Ä—Ö–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤—ã—à–µ)
                    const distanceToTop = playerBottom - platformTop;
                    
                    // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—ã—à–µ –∏–ª–∏ —Å–ª–µ–≥–∫–∞ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
                    if (distanceToTop >= -10 && distanceToTop <= 25) {
                        // –¢–æ—á–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞ –ù–ê –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
                        game.player.y = platformTop - game.player.height;
                        game.player.velY = 0;
                        game.player.onGround = true;
                        game.coyoteTime = 5; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º coyote time
                        game.canBoostJump = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å–∏–ª–µ–Ω–∏—è
                    }
                }
            });
            
            // Coyote Time - –º–æ–∂–Ω–æ –ø—Ä—ã–≥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            if (!game.player.onGround && wasOnGround && game.coyoteTime > 0) {
                game.coyoteTime--;
            } else if (!game.player.onGround && !wasOnGround) {
                game.coyoteTime = Math.max(0, game.coyoteTime - 1);
            }

            // –°–±–æ—Ä –∑–≤–µ–∑–¥–æ—á–µ–∫ - —É–≤–µ–ª–∏—á–µ–Ω—ã —Ä–∞–¥–∏—É—Å—ã –∏ —É–ª—É—á—à–µ–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å
            game.starItems.forEach((star, index) => {
                if (!star.collected) {
                    const playerCenterX = game.player.x + game.player.width / 2;
                    const playerCenterY = game.player.y + game.player.height / 2;
                                    const starCenterX = star.x + 15; // —Ü–µ–Ω—Ç—Ä –∑–≤–µ–∑–¥–æ—á–∫–∏ (30px/2)
                const starCenterY = star.y + 15;
                    
                    const distance = Math.sqrt(
                                            Math.pow(playerCenterX - starCenterX, 2) + 
                    Math.pow(playerCenterY - starCenterY, 2)
                    );
                    
                    if (distance < 70) { // —Ä–∞–¥–∏—É—Å —Å–±–æ—Ä–∞
                        collectStar(index);
                    }
                }
            });

            // –°–±–æ—Ä —Ñ—Ä–∞–∑ - —É–≤–µ–ª–∏—á–µ–Ω—ã —Ä–∞–¥–∏—É—Å—ã –∏ —É–ª—É—á—à–µ–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å
            game.phraseItems.forEach((phrase, index) => {
                if (!phrase.collected) {
                    const playerCenterX = game.player.x + game.player.width / 2;
                    const playerCenterY = game.player.y + game.player.height / 2;
                    const phraseCenterX = phrase.x + 100; // –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä —Ñ—Ä–∞–∑—ã
                    const phraseCenterY = phrase.y + 20;
                    
                    const distance = Math.sqrt(
                        Math.pow(playerCenterX - phraseCenterX, 2) + 
                        Math.pow(playerCenterY - phraseCenterY, 2)
                    );
                    
                    if (distance < 80) { // —Ä–∞–¥–∏—É—Å —Å–±–æ—Ä–∞
                        collectPhrase(index);
                    }
                }
            });
        }

        // –°–±–æ—Ä –∑–≤–µ–∑–¥–æ—á–∫–∏
        function collectStar(index) {
            const star = game.starItems[index];
            if (star.collected) return;
            
            star.collected = true;
            game.stars++;
            game.score += 500;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç–æ–π –ø–ª—é—Å–∏–∫ –¥–ª—è –∑–≤–µ–∑–¥—ã
            const plusElement = document.createElement('div');
            plusElement.className = 'plus-effect star-plus';
            plusElement.textContent = '+500';
            plusElement.style.left = star.x + 'px';
            plusElement.style.top = star.y + 'px';
            plusElement.style.color = '#ffd700';
            plusElement.style.textShadow = '0 0 10px rgba(255, 215, 0, 0.8)';
            document.getElementById('gameContainer').appendChild(plusElement);
            
            // –£–±–∏—Ä–∞–µ–º –ø–ª—é—Å–∏–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                if (plusElement.parentNode) {
                    plusElement.parentNode.removeChild(plusElement);
                }
            }, 1000);
            
            star.element.classList.add('collected');
            setTimeout(() => {
                if (star.element.parentNode) {
                    star.element.parentNode.removeChild(star.element);
                }
            }, 600);
        }

        // –°–±–æ—Ä —Ñ—Ä–∞–∑—ã
        function collectPhrase(index) {
            const phrase = game.phraseItems[index];
            if (phrase.collected) return;
            
            phrase.collected = true;
            game.phrases++;
            game.score += 333; // –§—Ä–∞–∑—ã –¥–∞—é—Ç –±–æ–ª—å—à–µ –æ—á–∫–æ–≤
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–µ–ª–µ–Ω—ã–π –ø–ª—é—Å–∏–∫
            const plusElement = document.createElement('div');
            plusElement.className = 'plus-effect';
            plusElement.textContent = '+333';
            plusElement.style.left = phrase.x + 'px';
            plusElement.style.top = phrase.y + 'px';
            document.getElementById('gameContainer').appendChild(plusElement);
            
            // –£–±–∏—Ä–∞–µ–º –ø–ª—é—Å–∏–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                if (plusElement.parentNode) {
                    plusElement.parentNode.removeChild(plusElement);
                }
            }, 1000);
            
            // –°—Ä–∞–∑—É —É–±–∏—Ä–∞–µ–º —Ñ—Ä–∞–∑—É
            phrase.element.classList.add('collected');
            if (phrase.element.parentNode) {
                phrase.element.parentNode.removeChild(phrase.element);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ (—Å —É—á–µ—Ç–æ–º –∫–∞–º–µ—Ä—ã)
        function updatePlayerPosition() {
            const player = document.getElementById('player');
            player.style.left = game.player.x + 'px';
            player.style.top = (game.player.y + game.camera.y) + 'px'; // –£—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–º–µ—Ä—É
        }

        // –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function updatePlayerSprite() {
            const sprite = document.getElementById('player').querySelector('.player-sprite');
            const isMoving = Math.abs(game.player.velX) > 0.5;
            const isJumping = game.player.velY < -2; // –µ—Å–ª–∏ –ª–µ—Ç–∏—Ç –≤–≤–µ—Ä—Ö –±—ã—Å—Ç—Ä–æ
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞–º–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
            sprite.classList.remove('walking', 'jumping');
            
            if (isJumping) {
                sprite.classList.add('jumping');
            } else if (isMoving && game.player.onGround) {
                sprite.classList.add('walking');
            }
            
            // –û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–ø—Ä–∞–π—Ç–∞
            const baseTransform = game.player.facing === -1 ? 'scaleX(-1)' : 'scaleX(1)';
            if (!sprite.classList.contains('jumping') && !sprite.classList.contains('walking')) {
                sprite.style.transform = baseTransform;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞
        function handleJump() {
            const currentTime = Date.now();
            
            // Jump attempt
            
            // –ï—Å–ª–∏ –º–æ–∂–µ–º —É—Å–∏–ª–∏—Ç—å –ø—Ä—ã–∂–æ–∫ –≤ –≤–æ–∑–¥—É—Ö–µ
            if (game.canBoostJump && !game.player.onGround && game.coyoteTime === 0) {
                const timeSinceJump = currentTime - game.lastJumpTime;
                const isRising = game.player.velY < -1; // –∏–≥—Ä–æ–∫ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö
                
                // –ú–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å –µ—Å–ª–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤—Ä–µ–º–µ–Ω–∏ –ò–õ–ò –ø–æ–∫–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è
                if (timeSinceJump < game.jumpBoostWindow || isRising) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –ø—Ä—ã–∂–æ–∫ —Ä–∞–≤–Ω–æ–π —Å–∏–ª—ã!
                    const oldVelY = game.player.velY;
                    game.player.velY -= game.jumpPower; // –î–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –æ–¥–∏–Ω –ø—Ä—ã–∂–æ–∫
                    game.canBoostJump = false; // –ë–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è —É—Å–∏–ª–∏—Ç—å
                    
                    // Double jump activated
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä—ã–∂–∫–∞
                    const sprite = document.getElementById('player').querySelector('.player-sprite');
                    sprite.classList.add('jumping');
                    
                    return true;
                }
            }
            
            // –û–±—ã—á–Ω—ã–π –ø—Ä—ã–∂–æ–∫ —Å –∑–µ–º–ª–∏
            if (game.player.onGround || game.coyoteTime > 0) {
                game.player.velY = -game.jumpPower; // –ü–µ—Ä–≤—ã–π –ø—Ä—ã–∂–æ–∫
                game.player.onGround = false;
                game.coyoteTime = 0;
                game.lastJumpTime = currentTime;
                game.canBoostJump = true; // –ú–æ–∂–µ–º —É—Å–∏–ª–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                
                // First jump
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä—ã–∂–∫–∞
                const sprite = document.getElementById('player').querySelector('.player-sprite');
                sprite.classList.remove('jumping');
                setTimeout(() => sprite.classList.add('jumping'), 10);
                
                return true;
            } else {
                // Cannot jump
                return false;
            }
        }



        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.getElementById('mushroomCount').textContent = game.stars;
            document.getElementById('phraseCount').textContent = game.phrases;
            document.getElementById('scoreCount').textContent = game.score;
            document.getElementById('livesCount').textContent = game.lives;
            document.getElementById('heightCount').textContent = Math.floor(game.height);
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame() {
            game.isRunning = false;
            clearInterval(game.gameLoop);
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º—É–∑—ã–∫—É
            const music = document.getElementById('backgroundMusic');
            music.pause();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('finalMushrooms').textContent = game.stars;
            document.getElementById('finalPhrases').textContent = game.phrases;
            document.getElementById('finalHeight').textContent = Math.floor(game.height);
            document.getElementById('finalScore').textContent = game.score;
            
            document.getElementById('gameOver').style.display = 'flex';
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            // –û—á–∏—Å—Ç–∫–∞ —É—Ä–æ–≤–Ω—è
            document.querySelectorAll('.platform, .mushroom, .track-phrase').forEach(el => {
                if (el.parentNode) el.parentNode.removeChild(el);
            });
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            game.score = 0;
            game.stars = 0;
            game.phrases = 0;
            game.lives = 3;
            game.height = 0; // –°–±—Ä–æ—Å –≤—ã—Å–æ—Ç—ã
            game.coyoteTime = 0; // –°–±—Ä–æ—Å coyote time
            game.lastJumpTime = 0; // –°–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä—ã–∂–∫–∞
            game.canBoostJump = false; // –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å–∏–ª–µ–Ω–∏—è
            game.player.x = 50;
            const startPlatformY = game.canvas.height - 80; // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç createLevel
            game.player.y = startPlatformY - game.player.height; // –¢–æ—á–Ω–æ –ù–ê –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
            game.player.velX = 0;
            game.player.velY = 0;
            game.player.onGround = true;
            // –°–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã
            game.camera.y = 0;
            game.camera.targetY = 0;
            game.lastPlatformY = 0;
            game.starItems = [];
            game.phraseItems = [];
            game.platforms = [];

            // –°–±—Ä–æ—Å –º—É–∑—ã–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            const music = document.getElementById('backgroundMusic');
            music.pause();
            music.currentTime = 0;
            game.gameTime = 0;
            game.currentPhraseIndex = 0;
            game.expectedOrder = 1;
            game.activePhrases = [];
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            createLevel();
            updateUI();
            updatePlayerPosition();
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
        });
    </script>
</body>
</html>